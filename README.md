# Travel Booking Monorepo

Монорепозиторий для проекта бронирования путешествий с настройкой метрик для сравнения.

## Структура проекта

```
travel-booking-monorepo/
├── packages/
│   └── travel-booking/          # Основное приложение
│       ├── app/                 # Next.js приложение
│       ├── components/          # React компоненты
│       ├── prisma/              # Схема базы данных
│       └── ...
├── scripts/                     # Скрипты для сбора метрик
├── metrics/                     # Директория для сохранения метрик
└── ...
```

## Метрики

В данном репозитории настроен сбор следующих метрик:

1. **Время между коммитом и полным деплоем приложения** - измеряется с помощью GitHub Actions, которые отслеживают времена коммита и завершения деплоя.
2. **Время полной сборки проекта** - измеряется через скрипты сборки, которые записывают время начала и окончания процесса сборки.

## Инструкции по установке

1. Клонировать репозиторий:
   ```bash
   git clone https://github.com/VikaDemkina/travel-booking-monorepo.git
   cd travel-booking-monorepo
   ```

2. Установить зависимости:
   ```bash
   pnpm install
   ```

3. Копировать пример .env файла и настроить переменные окружения:
   ```bash
   cp packages/travel-booking/.env.example packages/travel-booking/.env
   ```

4. Создать базу данных и запустить миграции:
   ```bash
   pnpm prisma:migrate
   ```

5. Запустить приложение:
   ```bash
   pnpm dev
   ```

## Сбор метрик

### Время сборки

Для измерения времени сборки используйте:

```bash
pnpm build:with-metrics
```

Метрики будут сохранены в директории `metrics/`.

### Время деплоя

Метрики деплоя собираются автоматически через GitHub Actions при каждом пуше в основную ветку.

## Просмотр метрик

Для просмотра собранных метрик используйте:

```bash
node scripts/view-metrics.js
```

## Дополнительная информация

### CI/CD Pipeline

CI/CD пайплайн настроен в GitHub Actions и выполняет следующие шаги:
1. Установка зависимостей
2. Сборка приложения с измерением времени
3. Деплой приложения (имитация в текущей настройке)
4. Сбор и сохранение метрик
5. Создание комментария в PR с метриками (при наличии PR)

### Реализация метрик "Время между коммитом и полным деплоем"

Метрика собирается следующим образом:
1. При старте GitHub Actions workflow сохраняется SHA коммита и время коммита
2. Перед деплоем сохраняется время начала деплоя
3. После завершения деплоя вычисляется:
   - Время от коммита до завершения деплоя
   - Время самого процесса деплоя
4. Метрики сохраняются в JSON-файл и выводятся в логи

### Реализация метрик "Время полной сборки проекта"

Метрика собирается следующим образом:
1. В Next.js приложении настроен instrumentation hook, который сохраняет время начала сборки
2. После завершения сборки вызывается скрипт, который сохраняет время окончания и вычисляет длительность
3. Метрики сохраняются в JSON-файл в директории `metrics/`
